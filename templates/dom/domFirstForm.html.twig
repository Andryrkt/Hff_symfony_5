{% extends 'base.html.twig' %}

{% block title %}Premier formulaire du DOM !
{% endblock %}

{% block body %}
	<div class="container">
		<div class="card p-3 mt-3">
			<div
				class="card-body">
				<!-- Messages flash pour debug -->
				{% for type, messages in app.flashes %}
					{% for message in messages %}
						<div class="alert alert-{{ type == 'error' ? 'danger' : type }} alert-dismissible fade show" role="alert">
							{{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
					{% endfor %}
				{% endfor %}

				<div class="row">
					<div class="col-12">
						<h3 class="perso-titre">Demande d'Ordre de Mission</h3>
					</div>
				</div>

				{{ form_start(form, {
                    'attr': {
                        'data-controller': 'dom-first-form',
                        'id': 'dom_form1',
                        'novalidate': false
                    }
                })}}

				<!-- Afficher les erreurs globales du formulaire -->
				{{ form_errors(form) }}

				<div class="row">
					<div class="col-md-6">
						{{ form_row(form.emetteur.agenceEmetteur, {
                            'attr': {
                                'data-action': 'change->dom-first-form#updateCategorie'
                            }
                        }) }}
					</div>
					<div class="col-md-6">
						{{ form_row(form.emetteur.serviceEmetteur) }}
					</div>
				</div>

				<div
					class="row">
					<!-- Type de Mission -->
					<div class="col-6">
						{{form_row(form.sousTypeDocument, {
                            'attr': {
                                'data-dom-first-form-target': 'sousTypeDocument',
                                'data-action': 'change->dom-first-form#updateCategorie'
                            }
                        })}}
					</div>
					<!-- Section Salarié -->
					<div class="col-6">
						{{ form_row(form.salarie, {
                            'attr': {
                                'data-dom-first-form-target': 'salarieType',
                                'data-action': 'change->dom-first-form#toggleFields'
                            }
                        }) }}
					</div>
				</div>

				<!-- Catégorie Dynamique -->
				<div class="row" data-dom-first-form-target="categorieGroup" style="display: none;">
					<div class="col-12">
						{% if form.categorie is defined %}
							{{ form_row(form.categorie) }}
						{% endif %}
					</div>
				</div>

				<!-- Champs Permanent (Matricule) -->
				<div class="row" data-dom-first-form-target="matriculeGroup">
					<div class="col-12">
						{{ form_label(form.matriculeNom) }}
						{{ form_widget(form.matriculeNom, {
                            'attr': {
                                'class': 'form-control custom-matricule-field',
                                'data-placeholder': 'Sélectionnez un personnel',
                                'data-dom-first-form-target': 'matriculeNomSelect'
                            }
                        }) }}
						{{ form_errors(form.matriculeNom) }}
					</div>
					<div class="col-12 mt-2">
						{{ form_row(form.matricule, {
                            'attr': {
                                'data-dom-first-form-target': 'matriculeInput',
                                'class': 'form-control',
                                'readonly': true
                            }
                        })}}
					</div>
				</div>

				<!-- Champs Temporaire (Nom/Prénom/CIN) -->
				<div class="row">
					<div class="col-md-4" data-dom-first-form-target="nomGroup" style="display: none;">
						{{ form_row(form.nom) }}
					</div>
					<div class="col-md-4" data-dom-first-form-target="prenomGroup" style="display: none;">
						{{ form_row(form.prenom) }}
					</div>
					<div class="col-md-4" data-dom-first-form-target="cinGroup" style="display: none;">
						{{ form_row(form.cin) }}
					</div>
				</div>

				<div class="row">
					<div class="col-12 mt-3">
						<button type="submit" class="btn btn-info fw-bold" id="submit-btn">
							Suivant
							<i class="fas fa-arrow-right"></i>
						</button>
						<button type="button" class="btn btn-secondary ms-2" onclick="console.log('Form debug:', new FormData(document.getElementById('dom_form1')))">
							Debug Form Data
						</button>
					</div>
				</div>

				{{ form_end(form) }}
			</div>
		</div>
	</div>
{% endblock %}
